[ì´ê²ƒì´ ìë°”ë‹¤_ê°œì •íŒ_ë¬´ë£Œ íŠ¹ë³„íŒ ë¶€ë¡.pdf](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c3f76682-f10f-4ad4-acc8-82f50b2eb04f/%EC%9D%B4%EA%B2%83%EC%9D%B4_%EC%9E%90%EB%B0%94%EB%8B%A4_%EA%B0%9C%EC%A0%95%ED%8C%90_%EB%AC%B4%EB%A3%8C_%ED%8A%B9%EB%B3%84%ED%8C%90_%EB%B6%80%EB%A1%9D.pdf)

# JDBC ê°œìš”

- `DriverManager` : DriverManager í´ë˜ìŠ¤ëŠ” JDBC Driverë¥¼ ê´€ë¦¬í•˜ë©° DBì™€ ì—°ê²°í•´ì„œ Connection êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
- `Connection` : Connection ì¸í„°í˜ì´ìŠ¤ëŠ” Statement, PreparedStatement, CallableStatement êµ¬í˜„ ê°ì²´ë¥¼
ìƒì„±í•˜ë©°, íŠ¸ëœì­ì…˜Transaction ì²˜ë¦¬ ë° DB ì—°ê²°ì„ ëŠì„ ë•Œ ì‚¬ìš©í•œë‹¤.
- `Statement` : Statement ì¸í„°í˜ì´ìŠ¤ëŠ” SQLì˜ DDLData Definition Languageê³¼ DMLData Manipulation Languageì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì£¼ë¡œ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ì •ì  SQL ë¬¸ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- `PreparedStatement` : PreparedStatementëŠ” Statementì™€ ë™ì¼í•˜ê²Œ SQLì˜ DDL, DML ë¬¸ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì°¨ì´ì ì€ ë§¤ê°œë³€ìˆ˜í™”ëœ SQL ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í¸ë¦¬ì„±ê³¼ ë³´ì•ˆì„±ì´ ì¢‹ë‹¤. ê·¸ë˜ì„œ Statementë³´ë‹¤ëŠ” PreparedStatementë¥¼ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.
- `CallableStatement` : CallableStatementëŠ” DBì— ì €ì¥ë˜ì–´ ìˆëŠ” í”„ë¡œì‹œì €procuderì™€ í•¨ìˆ˜functionë¥¼ í˜¸ì¶œí•  ë•Œ ì‚¬ìš©í•œë‹¤.
- `ResultSet` : ResultSetì€ DBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ì½ì„ ë•Œ ì‚¬ìš©í•œë‹¤.

---

# LOMBOK ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” ì–´ë…¸í…Œì´ì…˜

## @DATA

> `@Data`ëŠ” `@Getter`,Â `@Setter`,Â `@RequiredArgsConstructor`,Â `@ToString`,Â `@EqualsAndHashCode`ì„ í•œêº¼ë²ˆì— ì„¤ì •í•´ì£¼ëŠ” ë§¤ìš° ìœ ìš©í•œ ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤.
> 

# SQL ë°ì´í„° ì…ë ¥

```sql
use thisisjava;

create table users (
	  userid varchar(50) primary key,
    username varchar(50) not null,
    userpassword varchar(50) not null,
    userage numeric(3) not null,
    useremail varchar(50) not null
);

create table boards (
	  bno int auto_increment primary key,
    btitle varchar(100) not null,
    bcontent longtext not null,
    bwriter varchar(50) not null,
    bdate datetime default now(),
    bfilename varchar(50) null,
    bfiledata longblob null
);

create table accounts (
	ano varchar(20) primary key,
    owner varchar(20) not null,
    balance numeric not null
);

insert into accounts values ('111-111-1111', 'í•˜ì—¬ë¦„', 1000000);
insert into accounts values ('222-222-2222', 'í•œê²¨ìš¸', 0);

select * from accounts;
```

# DB ì—°ê²° (ConnectionExample)

```java
package mysql.sec05;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class ConnectionExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			System.out.println("ì—°ê²° ì„±ê³µ");
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		} catch (SQLException e) {
			e.printStackTrace();
		} finally {
			if(conn != null) {
				try {
					conn.close();
					System.out.println("ì—°ê²° ëŠê¸°");
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
		}

	}

}
```

---

# ë°ì´í„° ì €ì¥ (UserInsertExample)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c62d96cd-80b6-482c-b866-9d3877d06bcb/Untitled.png)

```java
package mysql.sec06;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class UserInsertExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			String sql = "INSERT INTO users(userid, username, userpassword, userage, useremail)"
							+ "VALUES (?, ?, ?, ?, ?)";
			
			PreparedStatement pstmt = conn.prepareStatement(sql);
			pstmt.setString(1, "winter");
			pstmt.setString(2, "í•œê²¨ìš¸");
			pstmt.setString(3, "12345");
			pstmt.setInt(4, 25);
			pstmt.setString(5, "winter@mycompany.com");
			
			int rows = pstmt.executeUpdate();
			System.out.println("ì €ì¥ëœ í–‰ ìˆ˜ : " + rows);
			
			pstmt.close();
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		} catch (SQLException e) {
			e.printStackTrace();
		} finally {
			if(conn != null) {
				try {
					conn.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
		}

	}

}
```

## PreparedStatement

> ë§¤ê°œë³€ìˆ˜í™”ëœ SQL ë¬¸ì„ ì‹¤í–‰í•˜ë ¤ë©´ PreparedStatementê°€ í•„ìš”í•˜ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ Connection
ì˜ prepareStatement() ë©”ì†Œë“œë¡œë¶€í„° PreparedStatementë¥¼ ì–»ëŠ”
> 

```java
PreparedStatement pstmt = conn.prepareStatement(sql);
```

### ?ì— ë“¤ì–´ê°ˆ ê°’ ì§€ì •í•˜ê¸°

> ?ëŠ” ìˆœì„œì— ë”°ë¼ 1ë²ˆë¶€í„° ë²ˆí˜¸ê°€ ë¶€ì—¬ëœë‹¤. ê°’ì˜ íƒ€ì…ì— ë”°ë¼ Setter ë©”ì†Œë“œë¥¼ ì„ íƒí•œ í›„ ì²« ë²ˆì§¸ì—ëŠ” ? ìˆœë²ˆ, ë‘ ë²ˆì§¸ì—ëŠ” ê°’ì„ ì§€ì •í•´ ì¤€ë‹¤.
> 

```java
String sql = new StringBuilder()
.append("INSERT INTO users (userid, username, userpassword, userage, useremail) ")
.append("VALUES (?, ?, ?, ?, ?)")
.toString();

pstmt.setString(1, "winter");
pstmt.setString(2, "í•œê²¨ìš¸");
pstmt.setString(3, "12345");
pstmt.setInt(4, 25);
pstmt.setString(5, "winter@mycompany.com");
```

### executeUpdate()

> ê°’ì„ ì§€ì •í•œ í›„ executeUpdate() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ SQL ë¬¸ì´ ì‹¤í–‰ë˜ë©´ì„œ users í…Œì´ë¸”ì— 1ê°œì˜ í–‰ì´ ì €ì¥ëœë‹¤. executeUpdate() ë©”ì†Œë“œê°€ ë¦¬í„´í•˜ëŠ” ê°’ì€ ì €ì¥ëœ í–‰ ìˆ˜ì¸ë°, ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆì„ ê²½ìš° 1ì„ ë¦¬í„´í•œë‹¤.
> 

```java
int rows = pstmt.executeUpdate(
```

### pstmt.close();

> PreparedStatementë¥¼ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš°ì—ëŠ” close ( ) ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•´ì„œ PreparedStatementê°€ ì‚¬ìš©í–ˆë˜ ë©”ëª¨ë¦¬ë¥¼ í•´ì œì‹œí‚¨ë‹¤.
> 

```java
pstmt.close();
```

# ë°ì´í„° ì €ì¥ (BoardInsertExample)

> ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ë•Œ ë§ˆë‹¤ bnoì€ auto_incrementë¡œ ìˆ«ìê°€ ê³„ì†ëŠ˜ì–´ë‚˜ë©´ì„œ í•„ë“œê°€ ì±„ì›Œì§„ë‹¤.
> 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/239fc0a9-6eda-4519-b6e1-5519e0631aeb/Untitled.png)

```java
package mysql.sec06;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class BoardInsertExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			String sql = "INSERT INTO boards (btitle, bcontent, bwriter, bdate, bfilename, bfiledata)"
							+ "VALUES (?, ?, ?, now(), ?, ?)";
			
			PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			pstmt.setString(1, "ëˆˆ ì˜¤ëŠ” ë‚ ");
			pstmt.setString(2, "í•¨ë°•ëˆˆì´ ë‚´ë ¤ìš”.");
			pstmt.setString(3, "winter");
			pstmt.setString(4, "snow.jpg");
			pstmt.setBlob(5, new FileInputStream("src/mysql/sec06/snow.jpg"));
			
			int rows = pstmt.executeUpdate();
			System.out.println("ì €ì¥ëœ í–‰ ìˆ˜ : " + rows);
			
			if(rows == 1) {
				ResultSet rs = pstmt.getGeneratedKeys();
				if(rs.next()) {
					int bno = rs.getInt(1);
					System.out.println("ì €ì¥ëœ bno : " + bno);
				}
				rs.close();
			}
			
			pstmt.close();
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		} catch (SQLException e) {
			e.printStackTrace();
		} catch (FileNotFoundException e) {
			e.printStackTrace();
		} finally {
			if(conn != null) {
				try {
					conn.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
		}
	}

}
```

---

# ë°ì´í„° ìˆ˜ì • (BoardUpdateExample)

> ì‚¬ì§„ìƒì˜ bnoì€ 1, 2, 3ìœ¼ë¡œ ìƒê°í•˜ê³  `"WHERE bno=?"`ì— ì˜í•´ `pstmt.setInt(5, 3)` ì´ sqlë¬¸ìœ¼ë¡œ 3ë²ˆì§¸ì— ìˆëŠ” ë‚´ìš©ë§Œ update ëœë‹¤.
> 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/df96ec69-ce04-461b-8185-e1f44f9f1224/Untitled.png)

```java
package mysql.sec07;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class BoardUpdateExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			String sql = "UPDATE boards SET btitle=?, bcontent=?, bfilename=?, bfiledata=?"
							+ "WHERE bno=?";
			
			PreparedStatement pstmt = conn.prepareStatement(sql);
			pstmt.setString(1, "ëˆˆì‚¬ëŒ");
			pstmt.setString(2, "ëˆˆìœ¼ë¡œ ë§Œë“  ì‚¬ëŒ");
			pstmt.setString(3, "snowman.jpg");
			pstmt.setBlob(4, new FileInputStream("src/mysql/sec07/snowman.jpg"));
			pstmt.setInt(5, 3);
			
			int rows = pstmt.executeUpdate();
			System.out.println("ì €ì¥ëœ í–‰ ìˆ˜ : " + rows);
			
			pstmt.close();
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		} catch (SQLException e) {
			e.printStackTrace();
		} catch (FileNotFoundException e) {
			e.printStackTrace();
		} finally {
			if(conn != null) {
				try {
					conn.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
		}

	}

}
```

---

# ë°ì´í„° ì‚­ì œ (BoardDeleteExample)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/149b10a8-9d6b-469c-8b7c-1b7ba1647167/Untitled.png)

```java
package mysql.sec08;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class BoardDeleteExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			String sql = "delete from boards where bwriter = ?";
			
			PreparedStatement pstmt = conn.prepareStatement(sql);
			pstmt.setString(1, "winter");
			
			int rows = pstmt.executeUpdate();
			System.out.println("ì‚­ì œëœ í–‰ ìˆ˜ : " + rows);
			
			pstmt.close();
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		} catch (SQLException e) {
			e.printStackTrace();
		} finally {
			if(conn != null) {
				try {
					conn.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
		}
		
		
	}
}
```

---

# ë°ì´í„° ì½ê¸° (UserSelectExample)

> `PreparedStatement`ë¥¼ ìƒì„±í•  ë•Œ SQL ë¬¸ì´ `INSERT, UPDATE, DELETE`ì¼ ê²½ìš°ì—
ëŠ” `executeUpdate ()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ, ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” SELECT ë¬¸ì¼ ê²½ìš°ì—ëŠ”
`executeQuery ()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•´ì•¼ í•œë‹¤. `executeQuery ()` ë©”ì†Œë“œëŠ” ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼
ResultSetì— ì €ì¥í•˜ê³  ë¦¬í„´í•œë‹¤.
> 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ee28283d-4ae8-4de3-be2a-06dfa4e6f1c7/Untitled.png)

```java
package mysql.sec09;

import lombok.Data;

@Data
public class User {
	private String userId;
	private String userName;
	private String userPassword;
	private int userAge;
	private String userEmail;

}

//

package mysql.sec09;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class UserSelectExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			String sql = "SELECT userid, username, userpassword, userage, useremail " 
							+ "FROM users WHERE userid = ?";
			
			PreparedStatement pstmt = conn.prepareStatement(sql);
			pstmt.setString(1, "winter");
			
			ResultSet rs = pstmt.executeQuery();
			if(rs.next()) {
//				String userId = rs.getString("userId");
//				String userName = rs.getString("userName");
//				String userPassword = rs.getString("userPassword");
//				int userAge = rs.getInt("userAge");
//				String userEmail = rs.getString("userEmail");
				
				User user = new User();
				user.setUserId(rs.getString("userid"));
				user.setUserName(rs.getString("username"));
				user.setUserPassword(rs.getString("userpassword"));
				user.setUserAge(rs.getInt(4)); 
				user.setUserEmail(rs.getString(5));

				System.out.println(user);
			} else {
				System.out.println("ì‚¬ìš©ì ì•„ì´ë””ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
			}
		} catch (ClassNotFoundException | SQLException e) {
			e.printStackTrace();
		} finally {
			if(conn != null) {
				try {
					conn.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
		}

	}

}

User(userId=winter, userName=í•œê²¨ìš¸, userPassword=12345, userAge=25, userEmail=winter@mycompany.com)
```

# ë°ì´í„° ì½ê¸° (BoardSelectExample)

> ì´ ë°ì´í„°ë¥¼ ì´í´ë¦½ìŠ¤ì—ì„œ ì½ì–´ì¤€ë‹¤.
> 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/77c14801-fd1d-4dd4-a07b-9001911d137b/Untitled.png)

```java
package mysql.sec09;

import java.sql.Blob;
import java.util.Date;
import lombok.Data;

@Data
public class Board {
	private int bno;
	private String btitle;
	private String bcontent;
	private String bwriter;
	private Date bdate;
	private String bfilename;
	private Blob bfiledata;
}

//

package mysql.sec09;

import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.OutputStream;
import java.sql.Blob;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class BoardSelectExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			String sql = "SELECT bno, btitle, bcontent, bwriter, bdate, bfilename, bfiledata " 
							+ "FROM boards WHERE bwriter = ?";
			
			PreparedStatement pstmt = conn.prepareStatement(sql);
			pstmt.setString(1, "winter");
			
			ResultSet rs = pstmt.executeQuery();
			while(rs.next()) {
				Board board = new Board();
				
				board.setBno(rs.getInt("bno"));
				board.setBtitle(rs.getString("btitle"));
				board.setBcontent(rs.getString("bcontent"));
				board.setBwriter(rs.getString("bwriter"));
				board.setBdate(rs.getDate("bdate"));
				board.setBfilename(rs.getString("bfilename"));
				board.setBfiledata(rs.getBlob("bfiledata"));
				
				System.out.println(board);
				
				Blob blob = board.getBfiledata();
				if(blob != null) {
					InputStream is = blob.getBinaryStream();
					OutputStream os = new FileOutputStream("C:/Temp/" +board.getBfilename());
					is.transferTo(os);
					os.flush();
					os.close();
					is.close();
				}
			}
			rs.close();
			
			pstmt.close();
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			try {
				conn.close();
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
		

	}

}

Board(bno=7, btitle=ë´„ì˜ ì •ì›, bcontent=ì •ì›ì˜ ê½ƒì´ ì˜ˆì˜ë„¤ìš”., bwriter=winter, bdate=2023-02-24, bfilename=spring.jpg, bfiledata=com.mysql.cj.jdbc.Blob@2f953efd)
Board(bno=8, btitle=í¬ë¦¬ìŠ¤ë§ˆìŠ¤, bcontent=ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤~, bwriter=winter, bdate=2023-02-24, bfilename=chrismas.jpg, bfiledata=com.mysql.cj.jdbc.Blob@d2de489)
Board(bno=9, btitle=ëˆˆ ì˜¤ëŠ” ë‚ , bcontent=í•¨ë°•ëˆˆì´ ë‚´ë ¤ìš”., bwriter=winter, bdate=2023-02-24, bfilename=snow.jpg, bfiledata=com.mysql.cj.jdbc.Blob@14bdbc74)
```

---

# íŠ¸ëœì­ì…˜ ì²˜ë¦¬

> `íŠ¸ëœì­ì…˜ (transaction)`ì€ ê¸°ëŠ¥ ì²˜ë¦¬ì˜ ìµœì†Œ ë‹¨ìœ„ë¥¼ ë§í•œë‹¤. í•˜ë‚˜ì˜ ê¸°ëŠ¥ì€ ì—¬ëŸ¬ ê°€ì§€ ì†Œì‘ì—…ë“¤ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤. ìµœì†Œ ë‹¨ìœ„ë€ ê²ƒì€ ì´ ì†Œì‘ì—…ë“¤ì„ ë¶„ë¦¬í•  ìˆ˜ ì—†ìœ¼ë©°, ì „ì²´ë¥¼ í•˜ë‚˜ë¡œ ë³¸ë‹¤ëŠ” ê°œë…ì´ë‹¤. íŠ¸ëœì­ì…˜ì€ ì†Œì‘ì—…ë“¤ì´ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.
> 

> ì˜ˆë¥¼ ë“¤ì–´ ê³„ì¢Œ ì´ì²´ëŠ” ì¶œê¸ˆ ì‘ì—…ê³¼ ì…ê¸ˆ ì‘ì—…ìœ¼ë¡œ êµ¬ì„±ëœ íŠ¸ëœì­ì…˜ì´ë‹¤. ì¶œê¸ˆê³¼ ì…ê¸ˆ ì‘ì—… ì¤‘ í•˜ë‚˜
ë§Œ ì„±ê³µí•  ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨ë˜ì–´ì•¼ í•œë‹¤.
> 

<aside>
ğŸ’¡ ì…ì¶œê¸ˆ ì‹¤í–‰ ì „ í›„

</aside>

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/29797b4c-bb08-49a5-be86-56d3b4f48ea3/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9ad08f85-23b8-4fef-9d4b-b720084cc87a/Untitled.png)

```java
package mysql.sec10;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class TransactionExample {

	public static void main(String[] args) {
		Connection conn = null;
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			
//			ë°©ë²• 1
//			String url = "jdbc:mysql://localhost:3306/thisisjava";
//			String id = "root";
//			String password = "1234";
//			conn = DriverManager.getConnection(url, id, password);
			
			conn = DriverManager.getConnection(
					"jdbc:mysql://localhost:3306/thisisjava",
					"root",
					"1234"
			);
			
			conn.setAutoCommit(false);
			
			String sql1 = "UPDATE accounts SET balance = balance - ? WHERE ano = ?";
			PreparedStatement pstmt1 = conn.prepareStatement(sql1);
			pstmt1.setInt(1, 10000);
			pstmt1.setString(2, "111-111-1111");
			int rows1 = pstmt1.executeUpdate();
			if(rows1 == 0) throw new Exception("ì¶œê¸ˆë˜ì§€ ì•Šì•˜ìŒ");
			pstmt1.close();
			
			String sql2 = "UPDATE accounts SET balance = balance + ? WHERE ano = ?";
			PreparedStatement pstmt2 = conn.prepareStatement(sql2);
			pstmt2.setInt(1, 10000);
			pstmt2.setString(2, "222-222-2222");
			int rows2 = pstmt2.executeUpdate();
			if(rows2 == 0) throw new Exception("ì…ê¸ˆë˜ì§€ ì•Šì•˜ìŒ");
			pstmt2.close();
			
			conn.commit();
			System.out.println("ê³„ì¢Œ ì´ì²´ ì„±ê³µ");
			
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		} catch (SQLException e) {
			e.printStackTrace();
		} catch (Exception e) {
			try {
				conn.rollback();
				System.out.println("ê³„ì¢Œ ì´ì²´ ì‹¤íŒ¨");
			} catch (SQLException e1) {
				e1.printStackTrace();
			}
			e.printStackTrace();
		} finally {
			if(conn != null) {
				try {
					conn.setAutoCommit(true);
					conn.close();
				} catch (SQLException e) {
					e.printStackTrace();
				}
			}
		}

	}

}
```
